<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Presentation Studio (Portrait & Landscape)</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background-color: #e2e8f0; color: #1e293b; padding: 15px; display: flex; justify-content: center; }
        .container { background: #ffffff; width: 100%; max-width: 650px; padding: 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        
        h2 { font-size: 24px; margin-bottom: 20px; text-align: center; color: #0f172a; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; }
        
        /* Top Settings Row */
        .settings-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .setting-box { background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #cbd5e1; }
        .setting-box label { font-size: 13px; font-weight: bold; color: #334155; display: block; margin-bottom: 5px; }
        .setting-box select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #94a3b8; font-weight: bold; outline: none; background: #fff; }

        #slidesWrapper { display: flex; flex-direction: column; gap: 20px; }
        .slide-box { background: #fdfbf7; border: 1px solid #cbd5e1; padding: 20px; border-radius: 8px; border-left: 5px solid #3b82f6; position: relative; }
        .cover-slide { border-left-color: #8b5cf6; background: #f5f3ff; }
        
        .slide-header { font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .slide-badge { background: #1e293b; color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 13px; }
        .remove-btn { color: #ef4444; background: none; border: none; font-weight: bold; cursor: pointer; padding: 5px;}
        
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        label { font-size: 13px; font-weight: 600; color: #475569; margin-bottom: -5px; display: block; }
        input[type="text"], textarea, input[type="file"], input[type="number"] {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 15px; background: #fff;
        }
        textarea { resize: vertical; min-height: 80px; font-family: 'Georgia', serif; }
        
        .media-group { background: #e0f2fe; padding: 15px; border-radius: 8px; border: 1px dashed #7dd3fc; margin-top: 5px; }

        .btn-group { margin-top: 25px; display: flex; flex-direction: column; gap: 12px; }
        button { padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .btn-add { background: #e2e8f0; color: #0f172a; border: 1px solid #cbd5e1; }
        .btn-video { background: #ef4444; color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
        
        #statusMessage { margin-top: 20px; font-size: 15px; font-weight: bold; text-align: center; padding: 12px; border-radius: 6px; display: none; }
        #downloadSection { display: none; margin-top: 15px; text-align: center; }
        .download-link { display: inline-block; width: 100%; padding: 15px; background: #10b981; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;}

        #processingArea { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>üé¨ Pro Slide to Video Studio</h2>

    <div class="settings-row">
        <div class="setting-box">
            <label>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú (View):</label>
            <select id="videoFormat">
                <option value="landscape">Landscape (16:9) - YouTube</option>
                <option value="portrait">Portrait (9:16) - Reels/Shorts</option>
            </select>
        </div>
        <div class="setting-box">
            <label>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶•‡¶ø‡¶Æ (Theme):</label>
            <select id="globalTheme">
                <option value="white">‡¶∏‡¶æ‡¶¶‡¶æ (Light Mode)</option>
                <option value="black">‡¶ï‡¶æ‡¶≤‡ßã (Dark Mode)</option>
            </select>
        </div>
    </div>

    <div id="slidesWrapper">
        <div class="slide-box cover-slide">
            <div class="slide-header">
                <span class="slide-badge">Slide 1 (Cover)</span>
                <span style="font-size: 12px; color: #64748b;">(‡¶ó‡ßã‡¶≤ ‡¶õ‡¶¨‡¶ø + ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ)</span>
            </div>
            <div class="form-grid">
                <label>‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ (Title):</label>
                <input type="text" class="s-title" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶≠‡¶æ‡¶∞‡¶§‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏">
                
                <label>‡¶∏‡¶æ‡¶¨‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ / ‡¶≤‡ßá‡¶ñ‡¶ï:</label>
                <textarea class="s-text" placeholder="‡¶≤‡¶ø‡¶ñ‡ßá‡¶õ‡ßá‡¶®..."></textarea>
                
                <div class="media-group">
                    <label>‡¶ï‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶® (‡¶ó‡ßã‡¶≤ ‡¶π‡ßü‡ßá ‡¶¨‡¶∏‡¶¨‡ßá):</label>
                    <input type="file" class="s-visual" accept="image/*">
                    <label style="margin-top: 10px;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï (Audio):</label>
                    <input type="file" class="s-audio" accept="audio/*">
                </div>

                <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶ü‡¶ø ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶ö‡¶≤‡¶¨‡ßá (Seconds):</label>
                <input type="number" class="s-duration" value="5" min="2" max="60">
            </div>
        </div>
    </div>

    <div class="btn-group">
        <button id="addSlideBtn" class="btn-add">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button id="exportVideoBtn" class="btn-video">üé• ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® (MP4)</button>
    </div>
    
    <div id="statusMessage"></div>
    <div id="downloadSection">
        <a id="videoDownloadLink" class="download-link" href="#">‚¨áÔ∏è ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    </div>

    <div id="processingArea">
        <canvas id="renderCanvas"></canvas>
    </div>
</div>

<script>
    const slidesWrapper = document.getElementById('slidesWrapper');
    const addSlideBtn = document.getElementById('addSlideBtn');
    const exportVideoBtn = document.getElementById('exportVideoBtn');
    const statusMessage = document.getElementById('statusMessage');
    const downloadSection = document.getElementById('downloadSection');
    const globalTheme = document.getElementById('globalTheme');
    const videoFormat = document.getElementById('videoFormat');
    const canvas = document.getElementById('renderCanvas');
    const ctx = canvas.getContext('2d');

    let slideCount = 1;

    addSlideBtn.addEventListener('click', () => {
        slideCount++;
        const slideHTML = `
            <div class="slide-box">
                <div class="slide-header">
                    <span class="slide-badge">Slide ${slideCount}</span>
                    <button class="remove-btn" onclick="this.parentElement.parentElement.remove()">‚ùå ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
                </div>
                <div class="form-grid">
                    <label>‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ (Title):</label>
                    <input type="text" class="s-title" placeholder="Chapter title...">
                    <label>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡ßá‡¶ñ‡¶æ (Content):</label>
                    <textarea class="s-text" placeholder="Write the details here..."></textarea>
                    
                    <div class="media-group">
                        <label>‡¶õ‡¶¨‡¶ø ‡¶¨‡¶æ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡¶ø‡¶® (Visual):</label>
                        <input type="file" class="s-visual" accept="image/*, video/mp4">
                        <label style="margin-top: 10px;">‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡¶æ ‡¶≠‡ßü‡ßá‡¶∏ ‡¶¶‡¶ø‡¶® (Audio):</label>
                        <input type="file" class="s-audio" accept="audio/*">
                    </div>

                    <label>‡¶∏‡¶Æ‡ßü (Seconds):</label>
                    <input type="number" class="s-duration" value="5" min="2" max="60">
                </div>
            </div>
        `;
        slidesWrapper.insertAdjacentHTML('beforeend', slideHTML);
    });

    function showStatus(msg, type) {
        statusMessage.style.display = 'block';
        statusMessage.innerText = msg;
        statusMessage.style.backgroundColor = type === 'error' ? '#fee2e2' : '#dcfce3';
        statusMessage.style.color = type === 'error' ? '#ef4444' : '#16a34a';
    }

    function wrapText(context, text, x, y, maxWidth, lineHeight) {
        let words = text.split(' ');
        let line = '';
        for(let n = 0; n < words.length; n++) {
            let testLine = line + words[n] + ' ';
            let metrics = context.measureText(testLine);
            if (metrics.width > maxWidth && n > 0) {
                context.fillText(line, x, y);
                line = words[n] + ' ';
                y += lineHeight;
            } else {
                line = testLine;
            }
        }
        context.fillText(line, x, y);
    }

    exportVideoBtn.addEventListener('click', async () => {
        const slideElements = document.querySelectorAll('.slide-box');
        if(slideElements.length === 0) return;

        showStatus("‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∞‡ßá‡¶°‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá... (‡¶™‡ßá‡¶ú ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá‡¶® ‡¶®‡¶æ)", "success");
        exportVideoBtn.disabled = true;
        downloadSection.style.display = 'none';

        // Orientation Setup (Landscape vs Portrait)
        const isPortrait = videoFormat.value === 'portrait';
        canvas.width = isPortrait ? 720 : 1280;
        canvas.height = isPortrait ? 1280 : 720;

        // Theme Setup
        const isDark = globalTheme.value === 'black';
        const bgColor = isDark ? '#000000' : '#ffffff';
        const titleColor = isDark ? '#ffffff' : '#1e293b';
        const textColor = isDark ? '#e2e8f0' : '#334155';
        const lineColor = isDark ? '#3b82f6' : '#2563eb';

        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const audioDest = audioCtx.createMediaStreamDestination();
            const canvasStream = canvas.captureStream(30);
            
            const combinedTracks = [...canvasStream.getVideoTracks(), ...audioDest.stream.getAudioTracks()];
            const combinedStream = new MediaStream(combinedTracks);

            let mimeType = MediaRecorder.isTypeSupported('video/mp4') ? 'video/mp4' : 'video/webm';
            const recorder = new MediaRecorder(combinedStream, { mimeType: mimeType });
            const chunks = [];

            recorder.ondataavailable = e => { if (e.data.size > 0) chunks.push(e.data); };
            recorder.onstop = () => {
                const blob = new Blob(chunks, { type: mimeType });
                const vLink = document.getElementById('videoDownloadLink');
                vLink.href = URL.createObjectURL(blob);
                vLink.download = `HD_Video_${isPortrait ? 'Portrait' : 'Landscape'}.${mimeType.includes('mp4') ? 'mp4' : 'webm'}`;
                downloadSection.style.display = 'block';
                showStatus("‚úÖ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∞‡ßá‡¶°‡¶ø! ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "success");
                exportVideoBtn.disabled = false;
            };

            recorder.start();

            for (let i = 0; i < slideElements.length; i++) {
                showStatus(`‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ${i + 1} ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`, "success");
                
                let el = slideElements[i];
                let title = el.querySelector('.s-title').value;
                let text = el.querySelector('.s-text').value;
                let duration = parseInt(el.querySelector('.s-duration').value) || 5;
                
                let visualFile = el.querySelector('.s-visual').files[0];
                let audioFile = el.querySelector('.s-audio').files[0];

                let mediaElement = null;
                let audioElement = null;
                let isVideo = false;

                if (visualFile) {
                    if (visualFile.type.startsWith('video')) {
                        isVideo = true;
                        mediaElement = document.createElement('video');
                        mediaElement.src = URL.createObjectURL(visualFile);
                        mediaElement.muted = true; 
                        mediaElement.playsInline = true;
                        await new Promise(res => { mediaElement.onloadeddata = res; });
                        mediaElement.play();
                    } else if (visualFile.type.startsWith('image')) {
                        mediaElement = new Image();
                        mediaElement.src = URL.createObjectURL(visualFile);
                        await new Promise(res => { mediaElement.onload = res; });
                    }
                }

                if (audioFile) {
                    audioElement = new Audio(URL.createObjectURL(audioFile));
                    const source = audioCtx.createMediaElementSource(audioElement);
                    source.connect(audioDest);
                    source.connect(audioCtx.destination);
                    await audioElement.play();
                }

                let totalFrames = duration * 30;
                let frameTime = 1000 / 30;

                for (let f = 0; f < totalFrames; f++) {
                    ctx.fillStyle = bgColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // Fade in
                    if (f < 20) { ctx.globalAlpha = f / 20; } else { ctx.globalAlpha = 1; }

                    if (i === 0) {
                        // ================= COVER SLIDE =================
                        let imgY = isPortrait ? 350 : 220;
                        let imgRadius = isPortrait ? 200 : 160;
                        let titleY = (mediaElement && !isVideo) ? (imgY + imgRadius + 100) : (canvas.height / 2);
                        
                        if (mediaElement && !isVideo) {
                            const imgX = canvas.width / 2;
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(imgX, imgY, imgRadius, 0, Math.PI * 2);
                            ctx.closePath();
                            ctx.clip();
                            ctx.drawImage(mediaElement, imgX - imgRadius, imgY - imgRadius, imgRadius * 2, imgRadius * 2);
                            ctx.restore();
                        }

                        let yOffset = f < 30 ? (30 - f) * 1.5 : 0;
                        
                        ctx.fillStyle = titleColor;
                        ctx.font = 'bold 70px Georgia'; 
                        ctx.textAlign = 'center';
                        ctx.fillText(title, canvas.width / 2, titleY + yOffset);
                        
                        ctx.fillStyle = textColor;
                        ctx.font = 'italic 40px Georgia'; 
                        ctx.fillText(text, canvas.width / 2, titleY + 70 + (yOffset/2));
                        
                        ctx.textAlign = 'left'; // Reset

                    } else {
                        // ================= CONTENT SLIDE =================
                        ctx.fillStyle = titleColor;
                        ctx.font = 'bold 55px Georgia';
                        ctx.fillText(title, 60, 100);
                        
                        ctx.fillStyle = lineColor;
                        ctx.fillRect(60, 130, canvas.width - 120, 4);

                        ctx.fillStyle = textColor;
                        ctx.font = '38px Georgia'; 

                        if (isPortrait) {
                            // Portrait Layout (Top to Bottom)
                            let textY = 200;
                            if (mediaElement) {
                                // ‡¶õ‡¶¨‡¶ø/‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶¨‡ßá
                                ctx.drawImage(mediaElement, 60, 180, 600, 420);
                                textY = 650; // ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                            }
                            wrapText(ctx, text, 60, textY, 600, 55);
                            
                            // Slide Number
                            ctx.fillStyle = isDark ? '#64748b' : '#94a3b8';
                            ctx.font = 'bold 24px Georgia';
                            ctx.fillText(`Slide ${i + 1}`, 580, 1220);
                        } else {
                            // Landscape Layout (Left & Right)
                            wrapText(ctx, text, 60, 210, mediaElement ? 550 : 1100, 55);
                            if (mediaElement) {
                                ctx.drawImage(mediaElement, 700, 180, 500, 380);
                            }
                            // Slide Number
                            ctx.fillStyle = isDark ? '#64748b' : '#94a3b8';
                            ctx.font = 'bold 24px Georgia';
                            ctx.fillText(`Slide ${i + 1}`, 1150, 680);
                        }
                    }

                    await new Promise(res => setTimeout(res, frameTime));
                }

                if (isVideo && mediaElement) mediaElement.pause();
                if (audioElement) { audioElement.pause(); audioElement.src = ""; }
            }

            recorder.stop();
            
        } catch (error) {
            console.error(error);
            showStatus("‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
            exportVideoBtn.disabled = false;
        }
    });
</script>

</body>
</html>