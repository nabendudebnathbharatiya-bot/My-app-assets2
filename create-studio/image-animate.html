<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freedom Fighters Tribute Animator</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #f4f7f6; 
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            background: #fff;
            width: 100%;
            max-width: 450px;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
        }
        h2 { font-size: 20px; margin-bottom: 15px; color: #2c3e50; }
        
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-size: 14px; margin-bottom: 5px; font-weight: 600; color: #555; }
        
        input[type="file"], select {
            width: 100%;
            padding: 10px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            font-size: 15px;
            background: #f8fafc;
            outline: none;
        }
        select { border-style: solid; border-color: #cbd5e1; }
        
        .canvas-container {
            width: 100%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        canvas { width: 100%; display: block; }

        button {
            width: 100%;
            padding: 14px;
            margin-bottom: 10px;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-record { background: #ea580c; } /* ‡¶§‡ßç‡¶Ø‡¶æ‡¶ó‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡ßÄ‡¶ï ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ï‡¶Æ‡¶≤‡¶æ/‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® */
        button:disabled { background: #cbd5e1; cursor: not-allowed; }
        
        #statusMessage { margin-top: 10px; font-size: 13px; font-weight: 600; }
        #downloadSection { display: none; margin-top: 15px; }
        .download-btn {
            display: inline-block;
            width: 100%;
            padding: 12px;
            background: #138808; /* ‡¶§‡ßá‡¶∞‡¶ô‡ßç‡¶ó‡¶æ‡¶∞ ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∞‡¶ô */
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üáÆüá≥ ‡¶ê‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ø‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶ü‡¶∞</h2>

    <div class="form-group">
        <label for="imageFile">‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶®:</label>
        <input type="file" id="imageFile" accept="image/*">
    </div>

    <div class="form-group">
        <label for="effectSelect">‡¶∂‡ßç‡¶∞‡¶¶‡ßç‡¶ß‡¶æ‡¶û‡ßç‡¶ú‡¶≤‡¶ø ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®:</label>
        <select id="effectSelect">
            <option value="none">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶õ‡¶¨‡¶ø (‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á)</option>
            <option value="sparks">üî• ‡¶Ö‡¶ó‡ßç‡¶®‡¶ø‡¶∏‡ßç‡¶´‡ßÅ‡¶≤‡¶ø‡¶ô‡ßç‡¶ó (‡¶¨‡¶ø‡¶™‡ßç‡¶≤‡¶¨‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡ßÄ‡¶ï)</option>
            <option value="tricolor">üáÆüá≥ ‡¶§‡ßá‡¶∞‡¶ô‡ßç‡¶ó‡¶æ ‡¶ï‡¶£‡¶æ (‡¶¶‡ßá‡¶∂‡¶™‡ßç‡¶∞‡ßá‡¶Æ)</option>
            <option value="vintage">üéûÔ∏è ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶ø‡¶®‡ßá‡¶Æ‡¶æ (‡¶ê‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡ßÇ‡¶™)</option>
            <option value="zoom">üé• ‡¶∏‡¶ø‡¶®‡ßá‡¶Æ‡¶æ‡¶ü‡¶ø‡¶ï ‡¶ú‡ßÅ‡¶Æ (Ken Burns)</option>
            <option value="rain">üåßÔ∏è ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø (Rain Effect)</option>
        </select>
    </div>

    <div class="canvas-container" id="canvasContainer">
        <canvas id="animCanvas"></canvas>
    </div>

    <button id="recordBtn" class="btn-record" disabled>üî¥ ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    
    <div id="statusMessage"></div>

    <div id="downloadSection">
        <a id="downloadLink" class="download-btn" href="#">‚¨áÔ∏è ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    </div>
</div>

<script>
    const imageFile = document.getElementById('imageFile');
    const effectSelect = document.getElementById('effectSelect');
    const canvasContainer = document.getElementById('canvasContainer');
    const canvas = document.getElementById('animCanvas');
    const ctx = canvas.getContext('2d');
    const recordBtn = document.getElementById('recordBtn');
    const statusMessage = document.getElementById('statusMessage');
    const downloadSection = document.getElementById('downloadSection');
    const downloadLink = document.getElementById('downloadLink');

    let uploadedImg = new Image();
    let isImageLoaded = false;
    let animationFrameId;
    let particles = [];
    let scale = 1.0;
    let scaleDirection = 1;
    let vintageTime = 0;

    const CANVAS_WIDTH = 600;
    
    // ‡¶§‡ßá‡¶∞‡¶ô‡ßç‡¶ó‡¶æ‡¶∞ ‡¶∞‡¶ô (‡¶ó‡ßá‡¶∞‡ßÅ‡ßü‡¶æ, ‡¶∏‡¶æ‡¶¶‡¶æ, ‡¶∏‡¶¨‡ßÅ‡¶ú)
    const tricolorPalette = ['rgba(255, 153, 51, 0.8)', 'rgba(255, 255, 255, 0.8)', 'rgba(19, 136, 8, 0.8)'];
    // ‡¶Ü‡¶ó‡ßÅ‡¶®‡ßá‡¶∞ ‡¶∞‡¶ô (‡¶≤‡¶æ‡¶≤, ‡¶ï‡¶Æ‡¶≤‡¶æ, ‡¶π‡¶≤‡ßÅ‡¶¶)
    const firePalette = ['rgba(255, 69, 0, 0.9)', 'rgba(255, 140, 0, 0.9)', 'rgba(255, 215, 0, 0.8)'];

    imageFile.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                uploadedImg.onload = function() {
                    const ratio = uploadedImg.height / uploadedImg.width;
                    canvas.width = CANVAS_WIDTH;
                    canvas.height = CANVAS_WIDTH * ratio;
                    
                    isImageLoaded = true;
                    canvasContainer.style.display = 'block';
                    recordBtn.disabled = false;
                    
                    if(animationFrameId) cancelAnimationFrame(animationFrameId);
                    initParticles();
                    animate();
                };
                uploadedImg.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    effectSelect.addEventListener('change', () => {
        initParticles();
        scale = 1.0; 
    });

    function initParticles() {
        particles = [];
        const effect = effectSelect.value;
        
        let count = 0;
        if(effect === 'rain') count = 100;
        if(effect === 'sparks') count = 80;
        if(effect === 'tricolor') count = 60;

        for (let i = 0; i < count; i++) {
            let p = {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                angle: Math.random() * Math.PI * 2
            };

            if (effect === 'rain') {
                p.speed = Math.random() * 10 + 10;
                p.length = Math.random() * 20 + 10;
                p.drift = 1;
            } else if (effect === 'sparks') {
                p.y = canvas.height + Math.random() * 100; // ‡¶®‡¶ø‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶â‡¶†‡¶¨‡ßá
                p.speed = Math.random() * 2 + 1;
                p.radius = Math.random() * 3 + 1;
                p.color = firePalette[Math.floor(Math.random() * firePalette.length)];
            } else if (effect === 'tricolor') {
                p.speed = Math.random() * 1 + 0.5;
                p.radius = Math.random() * 4 + 2;
                p.color = tricolorPalette[Math.floor(Math.random() * tricolorPalette.length)];
                p.drift = Math.random() * 2 - 1;
            }
            particles.push(p);
        }
    }

    function animate() {
        if (!isImageLoaded) return;
        const effect = effectSelect.value;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ‡¶õ‡¶¨‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ì ‡¶ú‡ßÅ‡¶Æ
        ctx.save();
        if (effect === 'zoom') {
            scale += 0.0005 * scaleDirection;
            if (scale > 1.15) scaleDirection = -1;
            if (scale < 1.0) scaleDirection = 1;
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.scale(scale, scale);
            ctx.translate(-canvas.width / 2, -canvas.height / 2);
        }
        ctx.drawImage(uploadedImg, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        // ‡¶≠‡¶ø‡¶®‡¶ü‡ßá‡¶ú ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü (‡¶ê‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡ßÇ‡¶™)
        if (effect === 'vintage') {
            vintageTime++;
            // ‡¶∏‡ßá‡¶™‡¶ø‡ßü‡¶æ ‡¶ü‡ßã‡¶® (‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶¨‡¶æ‡¶¶‡¶æ‡¶Æ‡ßÄ ‡¶Ü‡¶∏‡ßç‡¶§‡¶∞‡¶£)
            ctx.fillStyle = 'rgba(112, 66, 20, 0.35)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶ø‡¶®‡ßá‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ö
            if (Math.random() > 0.6) {
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.lineWidth = Math.random() * 2;
                let xPos = Math.random() * canvas.width;
                ctx.beginPath();
                ctx.moveTo(xPos, 0);
                ctx.lineTo(xPos, canvas.height);
                ctx.stroke();
            }
        }

        // ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ
        if (effect === 'rain') {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.lineWidth = 1.5;
            particles.forEach(p => {
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x - p.drift, p.y + p.length);
                ctx.stroke();
                p.y += p.speed;
                p.x -= p.drift;
                if (p.y > canvas.height) { p.y = -p.length; p.x = Math.random() * canvas.width; }
            });
        } 
        else if (effect === 'sparks') {
            particles.forEach(p => {
                ctx.beginPath();
                ctx.fillStyle = p.color;
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                p.y -= p.speed; // ‡¶ì‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶ï‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                p.x += Math.sin(p.angle) * 1.5; // ‡¶Ü‡¶Å‡¶ï‡¶æ‡¶¨‡¶æ‡¶Å‡¶ï‡¶æ ‡¶π‡ßü‡ßá ‡¶â‡¶†‡¶¨‡ßá
                p.angle += 0.1;
                // ‡¶ì‡¶™‡¶∞‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶¨‡ßá
                if (p.y < 0) { p.y = canvas.height + 10; p.x = Math.random() * canvas.width; }
            });
        }
        else if (effect === 'tricolor') {
            particles.forEach(p => {
                ctx.beginPath();
                ctx.fillStyle = p.color;
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                p.y -= p.speed; // ‡¶ß‡ßÄ‡¶∞‡ßá ‡¶ì‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶ï‡ßá
                p.x += Math.sin(p.angle) * 0.5; 
                p.angle += 0.05;
                if (p.y < -10) { p.y = canvas.height + 10; p.x = Math.random() * canvas.width; }
            });
        }

        animationFrameId = requestAnimationFrame(animate);
    }

    // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á)
    recordBtn.addEventListener('click', () => {
        const stream = canvas.captureStream(30); 
        let mimeType = 'video/webm';
        
        if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
            mimeType = 'video/webm;codecs=vp9';
        } else if (MediaRecorder.isTypeSupported('video/mp4')) {
            mimeType = 'video/mp4';
        }

        const recorder = new MediaRecorder(stream, { mimeType: mimeType });
        let chunks = [];

        recorder.ondataavailable = e => chunks.push(e.data);
        
        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            downloadLink.href = url;
            let ext = mimeType.includes('mp4') ? 'mp4' : 'webm';
            downloadLink.download = `freedom_fighter_tribute.${ext}`;
            
            downloadSection.style.display = 'block';
            statusMessage.innerText = "‚úÖ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶ú‡ßü ‡¶π‡¶ø‡¶®‡ßç‡¶¶ üáÆüá≥";
            statusMessage.style.color = "#10b981";
            
            recordBtn.innerText = "üî¥ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®";
            recordBtn.disabled = false;
        };

        recorder.start();
        recordBtn.disabled = true;
        downloadSection.style.display = 'none';
        
        let timeLeft = 5;
        statusMessage.style.color = "#ea580c";
        
        const timer = setInterval(() => {
            statusMessage.innerText = `‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá... (${timeLeft} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø)`;
            timeLeft--;
            if (timeLeft < 0) {
                clearInterval(timer);
                recorder.stop();
            }
        }, 1000);
    });
</script>

</body>
</html>