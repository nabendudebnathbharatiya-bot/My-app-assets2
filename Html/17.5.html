<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eka Engine v17.5 (Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background: #0f172a; color: white; }
        
        /* Custom Scrollbar for Text Area */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #0891b2; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

    <div class="w-full max-w-4xl mb-8 flex justify-between items-center border-b border-slate-700 pb-4">
        <div>
            <h1 class="text-3xl font-bold text-cyan-400">‚ö° Eka Engine v17.5</h1>
            <p class="text-slate-400 text-sm">Split Screen (50/50) + Strict Stop Audio</p>
        </div>
        <button onclick="loadSample()" class="bg-cyan-900 hover:bg-cyan-800 text-cyan-200 px-4 py-2 rounded text-sm font-bold border border-cyan-700">
            Load Sample JSON
        </button>
    </div>

    <div class="w-full max-w-4xl space-y-6">
        
        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
            <h2 class="text-cyan-300 font-bold mb-3">Step 1: Paste JSON Here</h2>
            <textarea id="jsonInput" class="w-full h-32 bg-slate-950 border border-slate-600 rounded p-4 text-xs font-mono text-green-400 focus:outline-none focus:border-cyan-500" placeholder='[ { "type": "normal", "text": "..." } ]'></textarea>
            <button onclick="generateForm()" class="mt-4 w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 rounded transition">
                ‚¨áÔ∏è Create Editor Form
            </button>
        </div>

        <div id="formContainer" class="space-y-4"></div>

        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
            <h2 class="text-green-400 font-bold mb-3">Step 2: Generate Final Code</h2>
            <button onclick="generateFullHTML()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg shadow-lg mb-4 transform active:scale-95 transition">
                üöÄ Generate Player HTML
            </button>
            <textarea id="finalOutput" class="w-full h-48 bg-black border border-slate-600 rounded p-4 text-gray-300 text-xs font-mono focus:outline-none" readonly></textarea>
            <button onclick="copyToClipboard()" class="mt-3 w-full bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded transition">
                üìã Copy Code
            </button>
        </div>
    </div>
    <script>
        let slidesData = [];

        function loadSample() {
            const sample = [
                {
                    "id": 1,
                    "type": "intro",
                    "title": "v17.5 ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°",
                    "subtitle": "‡ß´‡ß¶/‡ß´‡ß¶ ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü + ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤",
                    "icon": "maximize", 
                    "text": "‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶¨‡ßú (‡ß´‡ß¶%), ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§",
                    "theme": "text-yellow-500",
                    "bg_music": "https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3"
                },
                {
                    "id": 2,
                    "type": "normal",
                    "character": "System",
                    "text": "‡¶è‡¶á ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶®‡ßá‡¶á‡•§ Strict Stop ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶∏‡ßá ‡¶π‡ßÅ‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶¨‡¶Ç ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡ßú ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶≤‡¶ø‡¶ñ‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶ï‡ßá‡¶ü‡ßá ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ, ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§",
                    "text_secondary": "Silence Check + Scroll Check",
                    "icon": "volume-x",
                    "theme": "text-stone-400",
                    "bg_music": ""
                }
            ];
            document.getElementById('jsonInput').value = JSON.stringify(sample, null, 4);
        }

        function adaptSlide(slide, index) {
            return {
                id: slide.id || (index + 1),
                type: slide.type || "normal",
                text_style: slide.text_style || (slide.type === 'intro' ? 'title' : 'normal'),
                icon: slide.icon || "",
                character: slide.character || "",
                text: slide.text || slide.response || "",
                text_secondary: slide.text_secondary || slide.subText || "",
                image: slide.image || "",
                theme: slide.theme || "theme-default",
                bg_music: slide.bg_music || "",
                sfx: slide.sfx || "",
                btn_text: slide.btn_text || "",
                btn_link: slide.btn_link || ""
            };
        }

        function generateForm() {
            const input = document.getElementById('jsonInput').value;
            const container = document.getElementById('formContainer');
            try {
                slidesData = JSON.parse(input).map(adaptSlide);
                container.innerHTML = '';
                slidesData.forEach((slide, index) => {
                    const html = `
                    <div class="bg-slate-900 p-4 rounded border-l-4 border-cyan-500">
                        <div class="flex justify-between mb-2"><span class="text-xs font-bold text-cyan-400">Slide ${slide.id}</span></div>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <textarea id="text_${index}" class="bg-slate-800 text-white text-xs p-2 rounded h-16" placeholder="Main Text">${slide.text}</textarea>
                            <textarea id="sec_${index}" class="bg-slate-800 text-orange-200 text-xs p-2 rounded h-16" placeholder="Sub Text">${slide.text_secondary}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <input id="char_${index}" value="${slide.character}" class="bg-slate-800 text-white text-xs p-2 rounded" placeholder="Character">
                            <div class="flex gap-1"><input id="icon_${index}" value="${slide.icon}" class="bg-slate-800 text-white text-xs p-2 rounded w-full" placeholder="Icon"><input type="checkbox" id="icon_on_${index}" ${slide.icon?'checked':''}></div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input id="img_${index}" value="${slide.image}" class="bg-slate-800 text-yellow-200 text-xs p-2 rounded" placeholder="Image/Video">
                            <input id="bgm_${index}" value="${slide.bg_music}" class="bg-slate-800 text-purple-300 text-xs p-2 rounded" placeholder="Music (Strict)">
                        </div>
                        <input type="hidden" id="type_${index}" value="${slide.type}">
                        <input type="hidden" id="style_${index}" value="${slide.text_style}">
                        <input type="hidden" id="theme_${index}" value="${slide.theme}">
                        <input type="hidden" id="sfx_${index}" value="${slide.sfx}">
                        <input type="hidden" id="btn_t_${index}" value="${slide.btn_text}">
                        <input type="hidden" id="btn_l_${index}" value="${slide.btn_link}">
                    </div>`;
                    container.insertAdjacentHTML('beforeend', html);
                });
            } catch (e) { alert("JSON Error!"); }
        }

        function generateFullHTML() {
            const updated = slidesData.map((s, i) => ({
                id: s.id, type: s.type, 
                text: document.getElementById(`text_${i}`).value,
                text_secondary: document.getElementById(`sec_${i}`).value,
                character: document.getElementById(`char_${i}`).value,
                icon: document.getElementById(`icon_on_${i}`).checked ? document.getElementById(`icon_${i}`).value : "",
                image: document.getElementById(`img_${i}`).value,
                bg_music: document.getElementById(`bgm_${i}`).value,
                theme: document.getElementById(`theme_${i}`).value,
                text_style: document.getElementById(`style_${i}`).value,
                sfx: document.getElementById(`sfx_${i}`).value,
                btn_text: document.getElementById(`btn_t_${i}`).value,
                btn_link: document.getElementById(`btn_l_${i}`).value
            }));

            const jsonStr = JSON.stringify(updated, null, 4);

            const template = `<!DOCTYPE html>
<html lang="bn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Story v17.5</title>
<script src="https://cdn.tailwindcss.com"><\/script><script src="https://unpkg.com/lucide@latest"><\/script>
<style>@import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
body{font-family:'Hind Siliguri',sans-serif;background:#000;overflow:hidden;height:100dvh;display:flex;flex-direction:column}
.style-title{font-size:2.2rem;text-align:center;font-weight:700;color:#fbbf24;display:flex;flex-direction:column;justify-content:center;height:100%;text-shadow:0 0 10px rgba(251,191,36,0.5)}
.style-normal{font-size:1.25rem;line-height:1.6;color:#e2e8f0}
/* Scrollbar */
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#0891b2;border-radius:2px}
</style></head><body>
<div id="start" class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center"><button onclick="start()" class="bg-cyan-600 text-white px-8 py-3 rounded-full font-bold animate-pulse">START STORY</button></div>

<div class="h-[50%] w-full relative bg-gray-900 border-b-4 border-cyan-900 overflow-hidden">
    <div id="bg" class="absolute inset-0 bg-cover bg-center hidden"></div>
    <video id="vid" class="absolute inset-0 w-full h-full object-cover hidden" loop playsinline></video>
    <div class="absolute bottom-0 w-full h-24 bg-gradient-to-t from-black to-transparent"></div>
</div>

<div class="h-[50%] w-full bg-slate-950 flex flex-col p-5 relative">
    <div id="char" class="text-cyan-400 font-bold text-lg mb-2 hidden bg-slate-900 px-3 py-1 rounded w-max border border-slate-800"></div>
    
    <div class="flex-1 overflow-y-auto pr-2">
        <div id="icon" class="text-yellow-400 mb-2 hidden"></div>
        <p id="sub" class="text-sm text-yellow-200 italic border-l-2 border-yellow-500 pl-2 mb-3 hidden"></p>
        <p id="txt" class="style-normal pb-10"></p>
    </div>

    <div class="pt-3 mt-2 border-t border-slate-800 flex justify-between items-center shrink-0">
        <div id="btns"></div>
        <button onclick="next()" class="bg-cyan-700 hover:bg-cyan-600 text-white px-6 py-2 rounded-full font-bold flex items-center gap-2">NEXT ‚ñ∂</button>
    </div>
</div>

<audio id="mus" loop></audio><audio id="sfx"></audio>

<script>
const data = ${jsonStr};
let idx=0, typing=false, tOut;
const el = { start:document.getElementById('start'), bg:document.getElementById('bg'), vid:document.getElementById('vid'), txt:document.getElementById('txt'), sub:document.getElementById('sub'), icon:document.getElementById('icon'), char:document.getElementById('char'), btns:document.getElementById('btns'), mus:document.getElementById('mus'), sfx:document.getElementById('sfx') };

function start(){ el.start.style.display='none'; render(0); }

function render(i){
    // STRICT STOP LOGIC
    el.mus.pause(); el.mus.currentTime=0; el.sfx.pause(); el.sfx.currentTime=0; el.vid.pause();

    if(i>=data.length) return alert("End.");
    const s = data[i];

    // Media
    el.bg.classList.add('hidden'); el.vid.classList.add('hidden');
    if(s.image){
        if(s.image.match(/\\.(mp4|webm)$/i)){ el.vid.src=s.image; el.vid.classList.remove('hidden'); el.vid.play().catch(()=>{}); }
        else{ el.bg.style.backgroundImage="url('"+s.image+"')"; el.bg.classList.remove('hidden'); }
    } else { el.bg.style.background = "#111"; el.bg.classList.remove('hidden'); }

    // Icon
    if(s.icon){ el.icon.innerHTML=\`<i data-lucide="\${s.icon}" class="w-8 h-8 md:w-10 md:h-10 animate-bounce"></i>\`; lucide.createIcons(); el.icon.classList.remove('hidden'); el.icon.className = s.text_style==='title' ? "text-yellow-400 mb-2 flex justify-center" : "text-yellow-400 mb-1 block"; }
    else { el.icon.classList.add('hidden'); }

    // Text & Layout
    el.txt.className = s.text_style==='title' ? "style-title" : "style-normal";
    
    if(s.text_style==='title'){
        el.char.classList.add('hidden');
        if(s.text_secondary){ el.sub.innerText=s.text_secondary; el.sub.classList.remove('hidden'); } else { el.sub.classList.add('hidden'); }
    } else {
        if(s.character){ el.char.innerText=s.character; el.char.classList.remove('hidden'); } else { el.char.classList.add('hidden'); }
        if(s.text_secondary){ el.sub.innerText=s.text_secondary; el.sub.classList.remove('hidden'); } else { el.sub.classList.add('hidden'); }
    }

    // Typewriter
    el.txt.innerHTML=""; clearTimeout(tOut); let c=0; typing=true;
    function type(){ if(c<s.text.length){ el.txt.innerHTML+=s.text.charAt(c); c++; tOut=setTimeout(type,15); } else { typing=false; } }
    type();

    // Audio
    if(s.bg_music){ el.mus.src=s.bg_music; el.mus.play().catch(()=>{}); }
    if(s.sfx){ el.sfx.src=s.sfx; el.sfx.play().catch(()=>{}); }

    // Buttons
    el.btns.innerHTML="";
    if(s.btn_text){ const b=document.createElement('button'); b.className="bg-green-600 text-white px-3 py-1 rounded text-sm mr-2"; b.innerText=s.btn_text; b.onclick=()=>location.href=s.btn_link; el.btns.appendChild(b); }
}

function next(){
    if(typing){ clearTimeout(tOut); el.txt.innerHTML=data[idx].text; typing=false; }
    else{ idx++; render(idx); }
}
<\/script></body></html>`;

            document.getElementById('finalOutput').value = template;
        }

        function copyToClipboard() {
            document.getElementById("finalOutput").select();
            document.execCommand("copy");
            alert("Code Copied!");
        }
    </script>
</body>
</html>