<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eka Engine v18: Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen">

    <div class="bg-slate-800 border-b border-slate-700 sticky top-0 z-50 shadow-lg">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-cyan-400">‚ö° Eka Engine v18</h1>
                <p class="text-xs text-slate-400">Triple Audio: Music + SFX + Voice</p>
            </div>
            <button onclick="loadUserJSON()" class="bg-cyan-700 hover:bg-cyan-600 text-white text-xs px-3 py-2 rounded font-bold">
                Test JSON
            </button>
        </div>
    </div>
    <div class="max-w-5xl mx-auto px-4 py-6 space-y-8">
        
        <section class="bg-slate-800 p-4 rounded-xl border border-slate-700">
            <h2 class="text-sm font-bold text-cyan-300 mb-2">Step 1: Paste JSON</h2>
            <textarea id="jsonInput" class="w-full h-32 bg-slate-900 border border-slate-600 rounded p-3 text-xs font-mono outline-none focus:border-cyan-500" placeholder='Paste JSON here...'></textarea>
            <button onclick="generateForm()" class="mt-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded w-full">
                ‚¨áÔ∏è Create Editor Form
            </button>
        </section>

        <div id="formContainer" class="space-y-6"></div>

        <section class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-2xl">
            <h2 class="text-sm font-bold text-green-400 mb-2">Step 2: Get HTML Code</h2>
            <button onclick="generateFullHTML()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded w-full mb-4 shadow-lg">
                üéÆ Generate v18 HTML
            </button>
            <textarea id="finalOutput" class="w-full h-48 bg-black border border-slate-600 rounded p-3 text-green-400 font-mono text-xs focus:outline-none" readonly></textarea>
            <button onclick="copyToClipboard()" class="mt-3 bg-slate-700 text-white py-2 px-4 rounded w-full text-sm">
                üìã Copy Code
            </button>
        </section>

    </div>
    <script>
        let slidesData = [];

        function loadUserJSON() {
            const sample = [
                {
                    "id": 1,
                    "type": "intro",
                    "title": "v18 ‡¶ü‡ßá‡¶∏‡ßç‡¶ü",
                    "subtitle": "Voice + Music + SFX",
                    "icon": "mic",
                    "bg_music": "https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3"
                },
                {
                    "id": 2,
                    "type": "normal",
                    "character": "Actor",
                    "text": "‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï, ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶≠‡ßü‡ßá‡¶∏‚Äî‡¶∏‡¶¨ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá‡•§",
                    "text_secondary": "‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                    "icon": "layers",
                    "bg_music": "", 
                    "sfx": "https://assets.mixkit.co/sfx/preview/mixkit-car-engine-idling-1436.mp3",
                    "voice": "https://assets.mixkit.co/sfx/preview/mixkit-male-voice-cheer-2010.mp3"
                }
            ];
            document.getElementById('jsonInput').value = JSON.stringify(sample, null, 4);
        }

        function adaptSlide(slide, index) {
            const id = slide.id || (index + 1);
            let mainText = slide.text || slide.response || "";
            let secText = slide.text_secondary || slide.subText || "";
            let style = "normal";
            if (slide.type === 'intro' || slide.type === 'punchline') {
                style = "title";
                if (slide.title) mainText = slide.title;
                if (slide.subtitle) secText = slide.subtitle;
            }
            let theme = slide.theme || "theme-default";
            if (slide.theme && !slide.theme.startsWith('theme-')) {
                 if (slide.theme.includes('amber')) theme = "theme-fire";
                 else if (slide.theme.includes('blue')) theme = "theme-ocean";
            }
            return {
                id: id, type: slide.type || "unknown", text_style: slide.text_style || style,
                icon: slide.icon || "", character: slide.character || "", text: mainText,
                text_secondary: secText, image: slide.image || "", theme: theme,
                bg_music: slide.bg_music || "", sfx: slide.sfx || "", voice: slide.voice || "", // New Voice Field
                btn_text: slide.btn_text || "", btn_link: slide.btn_link || ""
            };
        }

        function generateForm() {
            const input = document.getElementById('jsonInput').value;
            const container = document.getElementById('formContainer');
            try {
                const rawData = JSON.parse(input);
                container.innerHTML = ''; 
                slidesData = rawData.map((s, i) => adaptSlide(s, i));
                slidesData.forEach((slide, index) => {
                    const html = `
                        <div class="bg-slate-800 p-5 rounded-lg border-l-4 border-cyan-500 shadow-md">
                            <h3 class="text-white font-bold text-sm mb-3">Slide ${slide.id}</h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div>
                                        <div class="flex justify-between mb-1"><label class="text-xs text-cyan-300">Text Style</label><select id="style_${index}" class="bg-slate-700 text-[10px] text-white rounded px-1"><option value="normal" ${slide.text_style === 'normal' ? 'selected' : ''}>Normal</option><option value="title" ${slide.text_style === 'title' ? 'selected' : ''}>Title</option></select></div>
                                        <textarea id="text_${index}" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm h-20">${slide.text || ''}</textarea>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1"><label class="text-xs text-orange-300">SubText</label><div class="flex items-center gap-2"><input type="text" id="icon_${index}" value="${slide.icon || ''}" placeholder="Icon name" class="w-20 bg-slate-700 text-[10px] text-white rounded px-1"><input type="checkbox" id="icon_toggle_${index}" ${slide.icon ? 'checked' : ''} class="accent-cyan-500 h-3 w-3"></div></div>
                                        <textarea id="text_sec_${index}" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-orange-100 text-sm h-20">${slide.text_secondary || ''}</textarea>
                                    </div>
                                </div>
                                <input type="text" id="char_${index}" value="${slide.character || ''}" placeholder="Character Name" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3"><input type="text" id="img_${index}" value="${slide.image || ''}" placeholder="Image/Video URL" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-yellow-200 text-sm"><select id="theme_${index}" class="w-full bg-slate-700 border border-slate-600 rounded p-2 text-white text-sm"><option value="theme-default">üé® Rainbow</option><option value="theme-space" ${slide.theme === 'theme-space' ? 'selected' : ''}>üåå Space</option><option value="theme-fire" ${slide.theme === 'theme-fire' ? 'selected' : ''}>üî• Fire</option><option value="theme-ocean" ${slide.theme === 'theme-ocean' ? 'selected' : ''}>üåä Ocean</option><option value="theme-dark" ${slide.theme === 'theme-dark' ? 'selected' : ''}>‚ö´ Dark</option></select></div>
                                
                                <div class="space-y-2 pt-2 border-t border-slate-700">
                                    <input type="text" id="bgm_${index}" value="${slide.bg_music || ''}" placeholder="üéµ BG Music (Continuous)" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-purple-200 text-sm">
                                    <div class="grid grid-cols-2 gap-3">
                                        <input type="text" id="sfx_${index}" value="${slide.sfx || ''}" placeholder="üîä SFX (Effect)" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-green-200 text-sm">
                                        <input type="text" id="voice_${index}" value="${slide.voice || ''}" placeholder="üéôÔ∏è Voice (Speech)" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-blue-200 text-sm font-bold">
                                    </div>
                                </div>
                                
                                <input type="hidden" id="btn_text_${index}" value="${slide.btn_text || ''}"><input type="hidden" id="btn_link_${index}" value="${slide.btn_link || ''}">
                            </div>
                        </div>`;
                    container.insertAdjacentHTML('beforeend', html);
                });
            } catch (e) { alert("JSON Error: " + e.message); }
        }

        function generateFullHTML() {
            const updatedSlides = slidesData.map((slide, index) => {
                const iconName = document.getElementById(`icon_${index}`).value;
                const iconEnabled = document.getElementById(`icon_toggle_${index}`).checked;
                return {
                    id: slide.id, type: slide.type, text_style: document.getElementById(`style_${index}`).value,
                    icon: iconEnabled ? iconName : "", character: document.getElementById(`char_${index}`).value,
                    text: document.getElementById(`text_${index}`).value, text_secondary: document.getElementById(`text_sec_${index}`).value,
                    image: document.getElementById(`img_${index}`).value, theme: document.getElementById(`theme_${index}`).value,
                    bg_music: document.getElementById(`bgm_${index}`).value, sfx: document.getElementById(`sfx_${index}`).value,
                    voice: document.getElementById(`voice_${index}`).value, // Capture Voice Input
                    btn_text: document.getElementById(`btn_text_${index}`).value, btn_link: document.getElementById(`btn_link_${index}`).value
                };
            });
            const jsonDataString = JSON.stringify(updatedSlides, null, 4);

            const fullTemplate = `<!DOCTYPE html>
<html lang="bn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Story V18</title><script src="https://cdn.tailwindcss.com"><\/script><script src="https://unpkg.com/lucide@latest"><\/script><style>@import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');body{font-family:'Hind Siliguri',sans-serif;background:#000;overflow:hidden}.bubble{background:rgba(11,15,25,0.95);border:1px solid #06b6d4;box-shadow:0 0 25px rgba(6,182,212,0.2);border-radius:16px}@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}.theme-default{background:linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);background-size:400% 400%;animation:gradientMove 15s ease infinite}.theme-space{background:linear-gradient(to bottom,#0f2027,#203a43,#2c5364)}.theme-dark{background:#111}.style-title{font-size:2.8rem;text-align:center;font-weight:700;color:#fbbf24;text-shadow:0 0 15px rgba(251,191,36,0.6)}.style-normal{font-size:1.35rem;line-height:1.8;color:#f3f4f6}</style></head>
<body class="h-[100dvh] w-screen relative text-white overflow-hidden">
<div id="start-overlay" class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center"><h1 class="text-3xl font-bold text-cyan-400 mb-4">‡¶ó‡¶≤‡ßç‡¶™ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h1><button onclick="startGame()" class="bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-3 rounded-full font-bold shadow-lg animate-pulse">START</button></div>
<div id="bg-layer" class="absolute inset-0 bg-cover bg-center hidden"></div><video id="bg-video" class="absolute inset-0 w-full h-full object-cover hidden" loop playsinline></video><div class="absolute inset-0 bg-black/40"></div>
<div class="relative z-10 h-full w-full max-w-3xl mx-auto flex flex-col justify-end pb-12 px-5"><div id="char-name-box" class="self-start bg-cyan-600 text-white px-5 py-1 rounded-t-lg font-bold text-lg hidden translate-y-1 ml-2"></div><div id="text-bubble" class="bubble p-6 w-full backdrop-blur-sm min-h-[150px] flex flex-col justify-center"><div id="slide-icon" class="flex justify-center mb-2 text-yellow-400 hidden"></div><p id="sec-text" class="text-sm text-yellow-300 italic hidden mb-2 pl-2 border-l-2 border-yellow-500"></p><p id="dialogue-text" class="style-normal"></p><div class="flex justify-between items-end mt-4 pt-2 border-t border-slate-700/50"><div id="ext-btn-container"></div><button onclick="nextSlide()" class="bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-full font-bold shadow-lg ml-auto">NEXT ‚ñ∂</button></div></div></div>
<audio id="bg-music" loop></audio><audio id="sfx-player"></audio><audio id="voice-player"></audio>
<script>
const storyData = ${jsonDataString};
let currentIndex=0,isTyping=false,typingTimeout;
const dom={bg:document.getElementById('bg-layer'),video:document.getElementById('bg-video'),text:document.getElementById('dialogue-text'),secText:document.getElementById('sec-text'),icon:document.getElementById('slide-icon'),charName:document.getElementById('char-name-box'),extBtn:document.getElementById('ext-btn-container'),overlay:document.getElementById('start-overlay'),
bgMusic:document.getElementById('bg-music'),sfx:document.getElementById('sfx-player'),voice:document.getElementById('voice-player')};
function startGame(){dom.overlay.style.display='none';renderSlide(0)}
function renderSlide(index){
if(index>=storyData.length)return alert("‡¶ó‡¶≤‡ßç‡¶™ ‡¶∂‡ßá‡¶∑!");const slide=storyData[index];
dom.video.classList.add('hidden');dom.bg.classList.add('hidden');if(slide.image&&slide.image.trim()!==""){if(slide.image.match(/\\.(mp4|webm)$/i)){dom.video.classList.remove('hidden');dom.video.src=slide.image;dom.video.play().catch(()=>{})}else{dom.bg.classList.remove('hidden');dom.bg.style.backgroundImage="url('"+slide.image+"')"}}else{dom.bg.classList.remove('hidden');dom.bg.classList.add(slide.theme||'theme-default')}
if(slide.icon){dom.icon.innerHTML=\`<i data-lucide="\${slide.icon}" class="w-10 h-10 animate-bounce"></i>\`;lucide.createIcons();dom.icon.classList.remove('hidden')}else{dom.icon.classList.add('hidden')}
if(slide.type==='intro'||slide.title){dom.text.className="style-title";dom.charName.classList.add('hidden');document.getElementById('text-bubble').classList.add('items-center')}else{dom.text.className="style-normal";document.getElementById('text-bubble').classList.remove('items-center');if(slide.character){dom.charName.innerText=slide.character;dom.charName.classList.remove('hidden')}else{dom.charName.classList.add('hidden')}}
if(slide.text_secondary||slide.subText){dom.secText.innerText=slide.text_secondary||slide.subText;dom.secText.classList.remove('hidden')}else{dom.secText.classList.add('hidden')}
dom.text.innerHTML="";clearTimeout(typingTimeout);let i=0;isTyping=true;const txt=slide.text||slide.response||"";
function type(){if(i<txt.length){dom.text.innerHTML+=txt.charAt(i);i++;typingTimeout=setTimeout(type,20)}else{isTyping=false}}type();
// TRIPLE AUDIO LOGIC
if(slide.voice&&slide.voice.trim()!==""){dom.voice.src=slide.voice;dom.voice.play().catch(()=>{})}
if(slide.sfx&&slide.sfx.trim()!==""){dom.sfx.src=slide.sfx;dom.sfx.play().catch(()=>{})}
if(slide.bg_music&&slide.bg_music.trim()!==""){const cur=dom.bgMusic.getAttribute('src');if(cur!==slide.bg_music){dom.bgMusic.src=slide.bg_music;dom.bgMusic.play().catch(()=>{})}else if(dom.bgMusic.paused){dom.bgMusic.play().catch(()=>{})}}
dom.extBtn.innerHTML="";if(slide.btn_text&&slide.btn_link){const btn=document.createElement('button');btn.className="bg-green-600 text-white px-3 py-1 rounded text-sm font-bold mr-2";btn.innerText=slide.btn_text;btn.onclick=()=>window.location.href=slide.btn_link;dom.extBtn.appendChild(btn)}}
function nextSlide(){if(isTyping){clearTimeout(typingTimeout);const s=storyData[currentIndex];dom.text.innerHTML=s.text||s.response;isTyping=false}else{currentIndex++;renderSlide(currentIndex)}}
<\/script></body></html>`;

            document.getElementById('finalOutput').value = fullTemplate;
        }
        function copyToClipboard() { const copyText=document.getElementById("finalOutput"); copyText.select(); document.execCommand("copy"); alert("Code Copied!"); }
    </script>
</body>
</html>